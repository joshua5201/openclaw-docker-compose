services:
  openclaw:
    build:
      context: .
      dockerfile: Dockerfile.sandbox
    image: openclaw:local
    restart: unless-stopped
    ports:
      # Think twice if you want to change the binding to all IPs (0.0.0.0)
      - "127.0.0.1:${OPENCLAW_PORT}:18789" # Gateway UI (Localhost only)
      - "127.0.0.1:${OPENCLAW_BRIDGE_PORT}:18790" # Browser Bridge (Localhost only)
    volumes:
      - ./openclaw:/app/openclaw
      # Use a named volume for node_modules to keep it isolated from host
      - openclaw_node_modules:/app/openclaw/node_modules
      - ./config:/home/node/.openclaw
      - ./workspace:/home/node/.openclaw/workspace
    environment:
      - OPENCLAW_CONFIG_DIR=/home/node/.openclaw
      - OPENCLAW_WORKSPACE_DIR=/home/node/.openclaw/workspace
      - NODE_ENV=production
    working_dir: /app/openclaw
    stdin_open: true
    tty: true
    # Command to start the gateway
    command: node dist/index.js gateway --bind lan --port 18789

  browserless:
    image: browserless/chrome:latest
    restart: unless-stopped
    ports:
      - "127.0.0.1:${BROWSERLESS_PORT}:3000"
    shm_size: '2gb'
    environment:
      - CONCURRENT_SESSIONS=10

volumes:
  openclaw_node_modules:
